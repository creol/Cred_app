<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credentialing App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar { min-height: 100vh; background: #f8f9fa; }
        .main-content { min-height: 100vh; }
        .search-results { max-height: 60vh; overflow-y: auto; }
        .contact-form { background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .label-preview { border: 2px solid #ddd; border-radius: 8px; background: #fff; }
        .credentialed-badge { background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; }
        .ready-badge { background: #ffc107; color: #212529; padding: 4px 8px; border-radius: 4px; }
        .stats-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .template-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .template-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .template-item.selected {
            border-color: #28a745;
            background-color: #f8fff9;
        }
        
        .template-item.current-event-template {
            border-color: #28a745;
            background-color: #f8fff9;
            border-width: 2px;
        }
        
        .template-info h6 {
            margin: 0;
            color: #333;
        }
        
        .template-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .template-actions .btn {
            flex-shrink: 0;
        }
        
        .badge {
            font-size: 0.75em;
        }
        
        .badge.bg-success {
            background-color: #28a745 !important;
        }
        
        .badge.bg-info {
            background-color: #17a2b8 !important;
        }
        
        /* Fold-over badge styling */
        .fold-line {
            position: absolute;
            left: 0;
            right: 0;
            top: 300px;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, #ff6b6b 20%, #ff6b6b 80%, transparent 100%);
            border-top: 2px dashed #ff6b6b;
            z-index: 1000;
        }
        
        .badge-half {
            position: absolute;
            width: 100%;
            height: 50%;
            pointer-events: none;
            z-index: 999;
            transition: opacity 0.3s ease;
        }
        
        .badge-half.top-half {
            top: 0;
            border-bottom: 1px solid #ddd;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
        }
        
        .badge-half.bottom-half {
            bottom: 0;
            border-top: 1px solid #ddd;
            background: linear-gradient(0deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
        }
        
        .badge-half:hover {
            opacity: 0.8;
        }
        
        .badge-half .half-label {
            position: absolute;
            font-size: 10px;
            color: #999;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
        }
        
        .badge-half.top-half .half-label {
            bottom: 5px;
            left: 5px;
        }
        
        .badge-half.bottom-half .half-label {
            top: 5px;
            left: 5px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 sidebar p-3">
                <h4 class="mb-4"><i class="fas fa-id-card"></i> Credentialing App</h4>
                
                <!-- Event Selection -->
                <div class="mb-4">
                    <h6>Current Event</h6>
                    <div id="currentEvent" class="alert alert-info">
                        <strong id="eventName">No Event Selected</strong><br>
                        <small id="eventDate"></small>
                    </div>
                    <button class="btn btn-primary btn-sm" id="newEventBtn">
                        <i class="fas fa-plus"></i> New Event
                    </button>
                    <button class="btn btn-warning btn-sm" id="endEventBtn" style="display: none;">
                        <i class="fas fa-stop"></i> End Event
                    </button>
                    <button class="btn btn-outline-warning btn-sm" id="resetEventBtn" style="display: none;">
                        <i class="fas fa-undo"></i> Reset Event
                    </button>
                </div>

                <!-- Event History -->
                <div class="mb-4" id="eventHistorySection" style="display: none;">
                    <h6>Previous Events</h6>
                    <div id="eventHistory" class="mb-2">
                        <!-- Previous events will be listed here -->
                    </div>
                </div>

                <!-- Statistics -->
                <div class="mb-4">
                    <h6>Statistics</h6>
                    <div class="stats-card p-3 rounded">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="h5" id="totalContacts">0</div>
                                <small>Total</small>
                            </div>
                            <div class="col-4">
                                <div class="h5" id="credentialedCount">0</div>
                                <small>Credentialed</small>
                            </div>
                            <div class="col-4">
                                <div class="h5" id="percentage">0%</div>
                                <small>Complete</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mb-4">
                    <h6>Quick Actions</h6>
                    <button class="btn btn-outline-primary btn-sm w-100 mb-2" id="showTemplatesBtn">
                        <i class="fas fa-palette"></i> Templates
                    </button>
                    <button class="btn btn-outline-success btn-sm w-100 mb-2" id="exportDataBtn">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                    <button class="btn btn-outline-warning btn-sm w-100 mb-2" id="printStatsBtn">
                        <i class="fas fa-print"></i> Print Stats
                    </button>
                    <button class="btn btn-outline-info btn-sm w-100 mb-2" id="showSettingsBtn">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 main-content p-4">
                <!-- Search Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" id="searchInput" class="form-control" 
                                   placeholder="Search by name, birthdate, or address...">
                            <button class="btn btn-outline-secondary" id="clearSearchBtn">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="btn btn-primary" id="showManualAddBtn">
                                <i class="fas fa-plus"></i> Manual Add
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Search Results -->
                    <div class="col-md-6">
                        <h5>Search Results</h5>
                        <div id="searchResults" class="search-results">
                            <div class="text-muted text-center p-4">
                                <i class="fas fa-search fa-2x mb-3"></i>
                                <p>Start typing to search contacts...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Details & Preview -->
                    <div class="col-md-6">
                        <div id="contactPanel" class="contact-form p-3" style="display: none;">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 id="contactName">Contact Name</h5>
                                <div id="credentialStatus"></div>
                            </div>

                            <!-- Detailed Preview Button -->
                            <div class="text-center mb-3">
                                <button type="button" class="btn btn-outline-primary" onclick="showDetailedPreview()">
                                    <i class="fas fa-eye"></i> Detailed Preview
                                </button>
                            </div>

                            <!-- Contact Form -->
                            <div class="p-3 border rounded bg-light mb-3">
                                <h6 class="mb-3 text-primary">Contact Updates</h6>
                                <form id="contactForm">
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <label class="form-label">First Name</label>
                                        <input type="text" class="form-control" id="firstName" name="first_name">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <label class="form-label">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" name="last_name">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <label class="form-label">Birth Date</label>
                                        <input type="date" class="form-control" id="birthDate" name="birth_date">
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <label class="form-label">Mobile</label>
                                        <input type="tel" class="form-control" id="phone" name="phone">
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Address</label>
                                    <input type="text" class="form-control" id="address" name="address">
                                </div>
                                <div class="row">
                                    <div class="col-md-4 mb-2">
                                        <label class="form-label">City</label>
                                        <input type="text" class="form-control" id="city" name="city">
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <label class="form-label">State</label>
                                        <input type="text" class="form-control" id="state" name="state">
                                    </div>
                                    <div class="col-md-4 mb-2">
                                        <label class="form-label">ZIP</label>
                                        <input type="text" class="form-control" id="zip" name="zip">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" name="email">
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-success" id="printBtn">
                                        <i class="fas fa-print"></i> Confirm Credential and Print
                                    </button>
                                    <button type="button" class="btn btn-warning" id="unCredentialBtn" style="display: none;">
                                        <i class="fas fa-undo"></i> Un-Credential
                                    </button>
                                    <button type="button" class="btn btn-primary" id="saveContactBtn">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                </div>
                            </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Setup Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Event Setup</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm">
                        <div class="mb-3">
                            <label class="form-label">Event Name</label>
                            <input type="text" class="form-control" id="modalEventName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Event Date</label>
                            <input type="date" class="form-control" id="modalEventDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description (Optional)</label>
                            <textarea class="form-control" id="modalEventDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Import CSV (Optional)</label>
                            <input type="file" class="form-control" id="csvFile" accept=".csv">
                            <small class="text-muted">Upload a CSV file with contact information</small>
                            <div class="alert alert-info mt-2" role="alert">
                                <strong>Label Printing Instructions</strong>
                                <ul class="mb-0 mt-1">
                                    <li>Create your label layout in Word or LibreOffice Writer using <em>Mail Merge</em>.</li>
                                    <li>Use this exact CSV for the merge so record order matches the app.</li>
                                    <li>Include a <code>row_number</code> column in the CSV (1-based) for page mapping.</li>
                                    <li>Merge to a single PDF (one 4"×6" page per contact) in CSV order.</li>
                                    <li>Prepare a one-page fallback PDF for new contacts not in the CSV.</li>
                                </ul>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="createEventBtn">Create Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Templates Modal -->
    <div class="modal fade" id="templatesModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Label Templates</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between mb-3">
                        <button class="btn btn-primary" id="showVisualDesignerBtn">
                            <i class="fas fa-plus"></i> New Template
                        </button>
                        <button class="btn btn-outline-secondary" id="importTemplateBtn">
                            <i class="fas fa-upload"></i> Import
                        </button>
                        <button class="btn btn-outline-success" id="downloadFieldsBtn">
                            <i class="fas fa-download"></i> Download Field List
                        </button>
                    </div>
                    <div id="templatesList">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Label Designer Modal -->
    <div class="modal fade" id="labelDesignerModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Label Designer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Left Panel: Tools and Properties -->
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Tools</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary btn-sm" id="addTextBtn">
                                            <i class="fas fa-font"></i> Add Text
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="addImageBtn">
                                            <i class="fas fa-image"></i> Add Image
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="addCheckboxBtn">
                                            <i class="fas fa-check-square"></i> Add Checkbox
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="addLineBtn">
                                            <i class="fas fa-minus"></i> Add Line
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="addSquareBtn">
                                            <i class="fas fa-square"></i> Add Square
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="addTextAreaBtn">
                                            <i class="fas fa-paragraph"></i> Add Text Area
                                        </button>
                                        <hr>
                                        <button class="btn btn-outline-success btn-sm" id="addPdfBackgroundBtn">
                                            <i class="fas fa-file-pdf"></i> PDF Background
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" id="removePdfBackgroundBtn" style="display: none;">
                                            <i class="fas fa-times"></i> Remove PDF Background
                                        </button>
                                        <hr>
                                        <button class="btn btn-outline-danger btn-sm" id="deleteElementBtn">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Properties</h6>
                                </div>
                                <div class="card-body" id="elementProperties">
                                    <p class="text-muted">Select an element to edit its properties</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Center Panel: Canvas -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Label Canvas (4" × 6")</h6>
                                    <div>
                                        <button class="btn btn-outline-secondary btn-sm" id="previewBtn">
                                            <i class="fas fa-eye"></i> Preview
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" id="foldPreviewBtn">
                                            <i class="fas fa-undo"></i> Fold Preview
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="testPrintBtn">
                                            <i class="fas fa-print"></i> Test Print
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="labelCanvas" class="border" style="width: 400px; height: 600px; margin: 0 auto; position: relative; background: white;">
                                        <!-- Canvas content will be rendered here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Panel: Template Info and Actions -->
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Template Info</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Template Name</label>
                                        <input type="text" class="form-control" id="templateName" placeholder="Enter template name">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control" id="templateDescription" rows="3" placeholder="Enter description"></textarea>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" id="saveTemplateBtn">
                                            <i class="fas fa-save"></i> Save Template
                                        </button>
                                        <button class="btn btn-outline-primary" id="duplicateTemplateBtn">
                                            <i class="fas fa-copy"></i> Duplicate
                                        </button>
                                        <button class="btn btn-outline-secondary" id="loadTemplateBtn">
                                            <i class="fas fa-folder-open"></i> Load Template
                                        </button>
                                        <button class="btn btn-outline-info" id="exportTemplateBtn">
                                            <i class="fas fa-download"></i> Export Template
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Preview Modal -->
    <div class="modal fade" id="pdfPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">PDF Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <button type="button" class="btn btn-primary" id="downloadPdfBtn">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                        <button type="button" class="btn btn-success" id="printPdfBtn">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                    <div id="pdfPreviewContainer" class="border rounded p-3" style="background: #f8f9fa; min-height: 400px;">
                        <div id="pdfPreviewContent" class="text-center">
                            <p class="text-muted">Generating PDF preview...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modern Label Designer Modal -->
    <div class="modal fade" id="modernDesignerModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modern Label Designer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="row g-0 h-100">
                        <!-- Left Sidebar - Tools -->
                        <div class="col-md-3 bg-light p-3" style="height: 80vh; overflow-y: auto;">
                            <!-- Background Section -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-image"></i> Background</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <input type="file" id="backgroundUpload" class="form-control" accept=".pdf,.png,.jpg,.jpeg">
                                        <button class="btn btn-outline-danger btn-sm" id="removeBackground">
                                            <i class="fas fa-times"></i> Remove Background
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Fields Section -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-plus-circle"></i> Add Fields</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <select class="form-control" id="fieldSelector">
                                            <option value="">Select a field...</option>
                                        </select>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary btn-sm" id="addFieldBtn">
                                            <i class="fas fa-plus"></i> Add Selected Field
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" id="addTextField">
                                            <i class="fas fa-font"></i> Add Custom Text
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Properties Panel -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-cog"></i> Properties</h6>
                                </div>
                                <div class="card-body" id="propertiesPanel">
                                    <p class="text-muted">Select an object to edit its properties</p>
                                </div>
                            </div>

                            <!-- Template Actions -->
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0"><i class="fas fa-save"></i> Template</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success btn-sm" id="saveTemplate">
                                            <i class="fas fa-save"></i> Save Template
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" id="exportTemplate">
                                            <i class="fas fa-download"></i> Export Template
                                        </button>
                                        <button class="btn btn-outline-info btn-sm" id="printPreview">
                                            <i class="fas fa-eye"></i> Print Preview
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" id="testPrint">
                                            <i class="fas fa-print"></i> Test Print
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Center - Canvas -->
                        <div class="col-md-9 d-flex justify-content-center align-items-center bg-secondary p-3">
                            <div class="position-relative">
                                <canvas id="modernLabelCanvas" class="border border-dark shadow"></canvas>
                                <div class="position-absolute top-0 start-0 bg-primary text-white px-2 py-1 small">
                                    4" × 6" Label (Fold at center line)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Visual Designer Modal -->
    <div class="modal fade" id="visualDesignerModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Visual Template Designer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="container-fluid h-100">
                        <div class="row h-100">
                            <!-- Left Sidebar - Tools -->
                            <div class="col-3 bg-light border-end p-3">
                                <h6><i class="fas fa-image"></i> Background</h6>
                                <div class="mb-3">
                                    <input type="file" class="form-control form-control-sm" id="visualBackgroundUpload" accept=".pdf,.png,.jpg,.jpeg">
                                    <small class="text-muted">Upload PDF, PNG, or JPG</small>
                                </div>
                                <button class="btn btn-sm btn-outline-danger w-100 mb-4" id="visualRemoveBackground">
                                    <i class="fas fa-trash"></i> Remove Background
                                </button>

                                <h6><i class="fas fa-plus-circle"></i> Add Fields</h6>
                                <div class="mb-3">
                                    <select class="form-select form-select-sm" id="fieldTypeSelect">
                                        <option value="">Choose field to add...</option>
                                        <!-- Fields will be populated dynamically -->
                                    </select>
                                </div>
                                <div class="btn-group w-100 mb-4" role="group">
                                    <button class="btn btn-sm btn-primary" id="visualAddFieldBtn">
                                        <i class="fas fa-plus"></i> Add Field
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" id="refreshFieldsBtn" title="Refresh fields from CSV">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>

                                <h6><i class="fas fa-cog"></i> Field Properties</h6>
                                <div id="fieldProperties" class="d-none">
                                    <div class="mb-2">
                                        <label class="form-label form-label-sm">Font Size</label>
                                        <input type="range" class="form-range" id="fontSizeSlider" min="8" max="72" value="12">
                                        <small id="fontSizeDisplay">12px</small>
                                    </div>
                                    <div class="mb-2">
                                        <label class="form-label form-label-sm">Font Family</label>
                                        <select class="form-select form-select-sm" id="fontFamilySelect">
                                            <option value="Arial">Arial</option>
                                            <option value="Times">Times</option>
                                            <option value="Courier">Courier</option>
                                            <option value="Calibri">Calibri</option>
                                        </select>
                                    </div>
                                    <div class="mb-2">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="checkbox" id="boldCheck">
                                            <label class="form-check-label" for="boldCheck"><strong>Bold</strong></label>
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <label class="form-label form-label-sm">Text Alignment</label>
                                                                            <div class="btn-group w-100" role="group">
                                        <button type="button" class="btn btn-outline-secondary btn-sm active" id="alignLeftBtn" title="Align Left">
                                            <i class="fas fa-align-left"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" id="alignCenterBtn" title="Align Center">
                                            <i class="fas fa-align-center"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary btn-sm" id="alignRightBtn" title="Align Right">
                                            <i class="fas fa-align-right"></i>
                                        </button>
                                    </div>
                                    </div>
                                    <div class="mb-2">
                                        <button class="btn btn-sm btn-outline-secondary w-100" id="rotateFieldBtn">
                                            <i class="fas fa-undo"></i> Rotate 180°
                                        </button>
                                    </div>
                                    <div class="mb-2">
                                        <button class="btn btn-sm btn-outline-danger w-100" id="deleteFieldBtn">
                                            <i class="fas fa-trash"></i> Delete Field
                                        </button>
                                    </div>
                                </div>

                                <h6 class="mt-3"><i class="fas fa-list"></i> Fields on Template</h6>
                                <div id="fieldsList" class="list-group small mb-3" style="max-height: 220px; overflow-y: auto;"></div>

                                <h6><i class="fas fa-history"></i> History</h6>
                                <div class="btn-group w-100 mb-3" role="group">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="visualUndoBtn" title="Undo">
                                        <i class="fas fa-undo"></i> Undo
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="visualRedoBtn" title="Redo">
                                        <i class="fas fa-redo"></i> Redo
                                    </button>
                                </div>

                                <h6><i class="fas fa-tools"></i> Layout Tools</h6>
                                <div class="mb-3">
                                    <div class="form-check form-check-sm mb-2">
                                        <input class="form-check-input" type="checkbox" id="snapToGridCheck" checked>
                                        <label class="form-check-label" for="snapToGridCheck">Snap to Grid (5px)</label>
                                    </div>
                                    <div class="form-check form-check-sm mb-2">
                                        <input class="form-check-input" type="checkbox" id="showCoordinatesCheck" checked>
                                        <label class="form-check-label" for="showCoordinatesCheck">Show Coordinates</label>
                                    </div>
                                    <div class="form-check form-check-sm mb-2">
                                        <input class="form-check-input" type="checkbox" id="showRulersCheck" checked>
                                        <label class="form-check-label" for="showRulersCheck">Show Rulers</label>
                                    </div>
                                    <div class="btn-group w-100 mb-2" role="group">
                                        <button type="button" class="btn btn-outline-primary btn-sm" id="centerHorizontalBtn" title="Center Horizontally">
                                            <i class="fas fa-arrows-alt-h"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-sm" id="centerVerticalBtn" title="Center Vertically">
                                            <i class="fas fa-arrows-alt-v"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-sm" id="centerBothBtn" title="Center Both">
                                            <i class="fas fa-crosshairs"></i>
                                        </button>
                                    </div>
                                </div>

                                <h6><i class="fas fa-layer-group"></i> Multi-Select Tools</h6>
                                <div id="multiSelectTools" class="mb-3">
                                    <div class="btn-group w-100 mb-2" role="group">
                                        <button type="button" class="btn btn-outline-success btn-sm" id="alignLeftMultiBtn" title="Align Left">
                                            <i class="fas fa-align-left"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" id="alignCenterMultiBtn" title="Align Center">
                                            <i class="fas fa-align-center"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" id="alignRightMultiBtn" title="Align Right">
                                            <i class="fas fa-align-right"></i>
                                        </button>
                                    </div>
                                    <div class="btn-group w-100 mb-2" role="group">
                                        <button type="button" class="btn btn-outline-success btn-sm" id="alignTopBtn" title="Align Top">
                                            <i class="fas fa-align-justify" style="transform: rotate(90deg);"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" id="alignMiddleBtn" title="Align Middle">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-success btn-sm" id="alignBottomBtn" title="Align Bottom">
                                            <i class="fas fa-align-justify" style="transform: rotate(90deg) scaleY(-1);"></i>
                                        </button>
                                    </div>
                                    <button type="button" class="btn btn-outline-info btn-sm w-100" id="distributeHorizontalBtn">
                                        <i class="fas fa-arrows-alt-h"></i> Distribute Horizontal
                                    </button>
                                </div>

                                <h6 class="mt-4"><i class="fas fa-save"></i> Template Actions</h6>
                                <div class="mb-2">
                                    <input type="text" class="form-control form-control-sm" id="templateNameInput" placeholder="Template Name">
                                </div>
                                <button class="btn btn-sm btn-outline-danger w-100 mb-2" id="clearTemplateBtn">
                                    <i class="fas fa-broom"></i> Clear Fields
                                </button>
                                <button class="btn btn-sm btn-success w-100 mb-2" id="saveTemplateBtn">
                                    <i class="fas fa-save"></i> Save Template
                                </button>
                                <button class="btn btn-sm btn-info w-100 mb-2" id="previewTemplateBtn">
                                    <i class="fas fa-eye"></i> Preview
                                </button>
                                <button class="btn btn-sm btn-warning w-100 mb-3" id="visualTestPrintBtn">
                                    <i class="fas fa-print"></i> Test Print
                                </button>
                                
                                <!-- PDF Positioning Offset Controls -->
                                <div class="card mb-3">
                                    <div class="card-header py-2">
                                        <h6 class="mb-0"><i class="fas fa-crosshairs"></i> PDF Position Adjustment</h6>
                                    </div>
                                    <div class="card-body py-2">
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <label class="form-label mb-1" style="font-size: 0.8em;">X Offset (px)</label>
                                                <input type="number" class="form-control form-control-sm" id="pdfOffsetX" value="0" min="-100" max="100" step="1">
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label mb-1" style="font-size: 0.8em;">Y Offset (px)</label>
                                                <input type="number" class="form-control form-control-sm" id="pdfOffsetY" value="0" min="-100" max="100" step="1">
                                            </div>
                                        </div>
                                        <div class="d-grid gap-1">
                                            <button class="btn btn-sm btn-outline-primary" id="applyOffsetBtn">
                                                <i class="fas fa-sync"></i> Apply & Test Print
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary" id="resetOffsetBtn">
                                                <i class="fas fa-undo"></i> Reset to 0,0
                                            </button>
                                        </div>
                                        <small class="text-muted">Tip: +30 X moves right, -30 X moves left</small>
                                    </div>
                                </div>
                                
                                <h6><i class="fas fa-eye"></i> Live Data Preview</h6>
                                <div class="mb-3">
                                    <button class="btn btn-sm btn-info w-100 mb-2" id="loadPreviewDataBtn">
                                        <i class="fas fa-database"></i> Load Preview Data
                                    </button>
                                    <div id="previewNavigation" class="d-none">
                                        <div class="row g-1 mb-2">
                                            <div class="col-4">
                                                <button class="btn btn-sm btn-outline-secondary w-100" id="prevRecordBtn" title="Previous Record">
                                                    <i class="fas fa-chevron-left"></i>
                                                </button>
                                            </div>
                                            <div class="col-4 text-center d-flex align-items-center justify-content-center">
                                                <small class="text-muted" id="recordCounter">1 / 10</small>
                                            </div>
                                            <div class="col-4">
                                                <button class="btn btn-sm btn-outline-secondary w-100" id="nextRecordBtn" title="Next Record">
                                                    <i class="fas fa-chevron-right"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-danger w-100" id="clearPreviewBtn">
                                            <i class="fas fa-times"></i> Clear Preview
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Main Canvas Area -->
                            <div class="col-9 p-0 position-relative">
                                <div id="canvasContainer" class="w-100 h-100 d-flex align-items-center justify-content-center bg-white">
                                    <canvas id="visualDesignerCanvas" width="576" height="864" style="border: 1px solid #ccc; max-height: 90vh; max-width: 90%;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="printer-tab" data-bs-toggle="tab" data-bs-target="#printer-settings" type="button" role="tab">
                                <i class="fas fa-print"></i> Printer Settings
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="app-tab" data-bs-toggle="tab" data-bs-target="#app-settings" type="button" role="tab">
                                <i class="fas fa-cog"></i> App Settings
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-3" id="settingsTabContent">
                        <!-- Printer Settings Tab -->
                        <div class="tab-pane fade show active" id="printer-settings" role="tabpanel">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">RX106HD Printer Configuration</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Printer Name</label>
                                                <input type="text" class="form-control" id="printerName" value="RX106HD" readonly>
                                                <small class="text-muted">Target printer for credential printing</small>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Label Size</label>
                                                <select class="form-control" id="labelSize">
                                                    <option value="4x6" selected>4" x 6" (Standard)</option>
                                                    <option value="3x5">3" x 5"</option>
                                                    <option value="2x4">2" x 4"</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">DPI</label>
                                                <select class="form-control" id="printerDpi">
                                                    <option value="203" selected>203 DPI (Standard)</option>
                                                    <option value="300">300 DPI (High Quality)</option>
                                                    <option value="150">150 DPI (Fast Print)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Print Options</label>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="foldOver" checked>
                                                    <label class="form-check-label" for="foldOver">
                                                        Fold-over labels
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="autoPrint" checked>
                                                    <label class="form-check-label" for="autoPrint">
                                                        Auto-print confirmation
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="showPrinterInfo" checked>
                                                    <label class="form-check-label" for="showPrinterInfo">
                                                        Show printer info in print window
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="alert alert-info">
                                                <h6><i class="fas fa-info-circle"></i> Printer Setup Instructions</h6>
                                                <ol class="mb-0">
                                                    <li>Go to Windows Settings > Devices > Printers</li>
                                                    <li>Right-click RX106HD > Set as default printer</li>
                                                    <li>Or select RX106HD in the print dialog each time</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- App Settings Tab -->
                        <div class="tab-pane fade" id="app-settings" role="tabpanel">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Application Settings</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Search Results Limit</label>
                                                <input type="number" class="form-control" id="searchLimit" value="50" min="10" max="200">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Search Debounce (ms)</label>
                                                <input type="number" class="form-control" id="searchDebounce" value="250" min="100" max="1000">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Performance</label>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enablePerformanceLogging">
                                                    <label class="form-check-label" for="enablePerformanceLogging">
                                                        Enable performance logging
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="enableDebugMode">
                                                    <label class="form-check-label" for="enableDebugMode">
                                                        Enable debug mode
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/modern-label-designer.js"></script>
    <script src="js/visual-designer.js"></script>

</html>
